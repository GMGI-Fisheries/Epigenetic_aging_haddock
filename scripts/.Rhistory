128/30
# count table 18S
otutab_18S <- read.delim("../metadata/SBNMS21-18S_ASV-counts_sediment-combined.txt", header=T, check.names=FALSE)
rownames(otutab_18S)<- otutab_18S[,1]
# 18S network table
otutab_18S_network <- otutab_18S %>% dplyr::rename(OTU_ID = `#OTU ID`) %>%
gather("SampleID", "reads", 2:101) %>%
filter(SampleID %in% sample_list$SampleID) %>% spread(SampleID, reads) %>%
column_to_rownames(var = "OTU_ID") %>%
mutate_if(is.character, as.numeric)
library(tidyverse)
library(phyloseq)
library(readxl)
load("../12S_phyloseq.Rdata")
load("../18S_phyloseq.Rdata")
load("../16S_phyloseq.Rdata")
samples_16S <- sample_names(physeq_16S)
samples_18S <- sample_names(physeq_18S)
samples_12S <- sample_names(physeq_12S)
# Print the number of samples in each
print(length(samples_16S)) # 100
print(length(samples_18S)) # 99
print(length(samples_12S)) # 86
# Check if they're identical
print(identical(sort(samples_16S), sort(samples_18S)))
# Find any differences
setdiff(samples_16S, samples_18S) ## N11-sediment does not appear in 18S data
setdiff(samples_18S, samples_12S)
# [1] "S4-surface"   "S6-surface"   "S9-sediment"  "S10-sediment" "C4-surface"   "N1-surface"   "N3-surface"   "N4-surface"
# [9] "N5-surface"   "N6-surface"   "N7-surface"   "N12-surface"  "N13-surface"  "N14-surface"  "N15-surface"
setdiff(samples_12S, samples_18S) ## "N11-sediment" "S1-surface" do not appear in 18S
## create df from samples list (84 samples)
sample_list <- intersect(
intersect(
setNames(as.data.frame(samples_16S), "SampleID"),
setNames(as.data.frame(samples_18S), "SampleID")
),
setNames(as.data.frame(samples_12S), "SampleID")
)
# META raw file and META networking (84 networking)
meta <- read.csv("../metadata/SBNMS_metadata_sediment-combined.csv", header=T)
meta_network <- meta %>%
filter(SampleID %in% sample_list$SampleID)
## Phyloseq objects
meta <- sample_data(meta)
rownames(meta) <- meta$SampleID
meta_network <- sample_data(meta_network)
rownames(meta_network) <- meta_network$SampleID
## ALL 12S data
data_12S <- read_excel("../Results_rawreads_long.xlsx") %>%
### filtering out unwanted species (livestock, human, unassigned)
subset(!Category == "unassigned" & !Category == "Livestock" & !Category == "Human") %>%
spread(sampleID, reads) %>%
dplyr::select(-Category, -Common_name) %>%
mutate_at(vars(-Species_name), as.numeric) %>%
mutate(across(c(-Species_name), ~replace_na(., 0))) %>%
column_to_rownames(var = "Species_name") %>%
dplyr::select(-`Sed_Neg2`)
names(data_12S) <- gsub("[_]", "-", names(data_12S))
## Network 12S data
data_12S_network <- data_12S %>% rownames_to_column(var = "Species_name") %>%
gather("SampleID", "reads", 2:87) %>%
filter(SampleID %in% sample_list$SampleID) %>% spread(SampleID, reads) %>%
column_to_rownames(var = "Species_name")
## creating phyloseq object
outtab_12S_network <- otu_table(data_12S_network, taxa_are_rows = T)
physeq_12S_network <- merge_phyloseq(outtab_12S_network, meta_network)
save(physeq_12S_network, file = "../12S_phyloseq_network_all.Rdata")
# 16S count table ALL
otutab_16S <- read.delim("../metadata/SBNMS21-16S_ASV-counts_sediment-combined.txt",
header=T, check.names=FALSE) %>%
mutate(ID = paste0("micro_", ID)) %>%
column_to_rownames(var = "ID")
# 16S network
otutab_16S_network <- otutab_16S %>% rownames_to_column(var = "ID") %>%
gather("SampleID", "reads", 2:101) %>%
filter(SampleID %in% sample_list$SampleID) %>% spread(SampleID, reads) %>%
column_to_rownames(var = "ID")
## Creating phyloseq obj
otutab_16S_network <- otu_table(otutab_16S_network, taxa_are_rows = T)
# 16S taxonomy
tax_16S <- read.delim("../metadata/SBNMS21-16S_silva-taxonomy.txt", header=F) %>%
dplyr::rename(ID = V1, Kingdom = V2, Phylum = V3, Class = V4, Order = V5,
Family = V6, Genus = V7, Taxonomy = V8, TaxC = V9, Tax2 = V10) %>%
mutate(ID = paste0("micro_", ID)) %>%
column_to_rownames(var = "ID")
tax_16S <- tax_table(as.matrix(tax_16S[,1:9]))
taxa_names(tax_16S) <- taxa_names(otutab_16S_network)
# convert to phyloseq object
physeq_16S_network <- merge_phyloseq(otutab_16S_network, tax_16S, meta_network)
# remove non-target sequences
physeq_16S_network <- subset_taxa(physeq_16S_network, Kingdom != "Eukaryota")
physeq_16S_network <- subset_taxa(physeq_16S_network, Kingdom != "unknown")
save(physeq_16S_network, file = "../16S_phyloseq_network_all.Rdata")
# count table 18S
otutab_18S <- read.delim("../metadata/SBNMS21-18S_ASV-counts_sediment-combined.txt", header=T, check.names=FALSE)
rownames(otutab_18S)<- otutab_18S[,1]
# 18S network table
otutab_18S_network <- otutab_18S %>% dplyr::rename(OTU_ID = `#OTU ID`) %>%
gather("SampleID", "reads", 2:101) %>%
filter(SampleID %in% sample_list$SampleID) %>% spread(SampleID, reads) %>%
column_to_rownames(var = "OTU_ID") %>%
mutate_if(is.character, as.numeric)
# creating phyloseq obj
otutab_18S_network <- otu_table(otutab_18S_network, taxa_are_rows = T)
# taxonomy
tax_18S <- read.csv("../metadata/SBNMS21-18S_curated-taxonomy.csv", header=F)
rownames(tax_18S)<- taxa_names(otutab_18S_network)
tax_18S <- tax_table(as.matrix(tax_18S[,2:11]))
taxa_names(tax_18S) <- taxa_names(otutab_18S_network)
# convert to phyloseq object
physeq_18S_network <- merge_phyloseq(otutab_18S_network, tax_18S, meta_network)
colnames(tax_table(physeq_18S_network)) <- c("Kingdom","Superphylum", "Phylum", "Class", "Order", "Family", "Genus","Species","Taxonomy","Tax2")
# remove non-target sequences
physeq_18S_network <- subset_taxa(physeq_18S_network, Kingdom != "Bacteria")
physeq_18S_network <- subset_taxa(physeq_18S_network, Kingdom != "unknown")
save(physeq_18S_network, file = "../18S_phyloseq_network_all.Rdata")
4.5*60
4.5*60/48
1260/47
598000/47
598000/47/60
598000/47/60/24
21*24
1000/24
1250/24
600/24
